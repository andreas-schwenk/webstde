"use strict";var webSTDE=(()=>{var O=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var Y=(s,t)=>{for(var e in t)O(s,e,{get:t[e],enumerable:!0})},V=(s,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of W(t))!q.call(s,n)&&n!==e&&O(s,n,{get:()=>t[n],enumerable:!(i=U(t,n))||i.enumerable});return s};var X=s=>V(O({},"__esModule",{value:!0}),s);var F={};Y(F,{GuiState:()=>A,guiState:()=>v,init:()=>j,machine:()=>p,mousePos:()=>L});function T(s,t){switch(t.clearRect(0,0,s.width,s.height),t.font="28px Arial",t.textAlign="left",t.fillText("output vector = [y1, y2]",10,35),p.draw(t),v){case"INSERT_STATE":t.strokeStyle="gray",P(t,!0,p.snap(L),220,100);break}}function P(s,t,e,i,n,g=""){t?(s.strokeStyle="blue",s.fillStyle="blue",s.lineWidth=4):(s.strokeStyle="black",s.fillStyle="black",s.lineWidth=2),s.beginPath(),s.ellipse(e.x,e.y,i/2,n/2,0,0,2*Math.PI),s.stroke(),s.moveTo(e.x-i/2,e.y),s.lineTo(e.x+i/2,e.y),s.stroke(),s.font="24px Arial",s.textAlign="center",s.fillText(g,e.x,e.y-n/6)}function R(s,t,e,i){t?(s.strokeStyle="blue",s.fillStyle="blue",s.lineWidth=4):(s.strokeStyle="black",s.fillStyle="black",s.lineWidth=2),s.moveTo(e.x,e.y),s.lineTo(i.x,i.y),s.stroke()}var x=class{constructor(){this.id="";this.signals=[];this.states=[];this.transitions=[]}addSignal(t){this.signals.push(t)}addState(t){this.states.push(t),this.recalculateStateIndices()}addTransition(t){this.transitions.push(t)}draw(t){for(let e of this.states)e.draw(t);for(let e of this.transitions)e.draw(t)}select(t){for(let e of this.states)e.select(t)}pickState(t){for(let e of this.states)if(e.pick(t))return e;return null}getSignals(){return this.signals}getStates(){return this.states}getSelectedStates(){let t=[];for(let e of this.states)e.isSelected()&&t.push(e);return t}deleteSelection(){let t=[];for(let e of this.states)e.isSelected()==!1&&t.push(e);this.states=t,this.recalculateStateIndices()}snap(t){let i=t;for(let n of this.states)Math.abs(n.getPos().x-t.x)<=25&&(i.x=n.getPos().x),Math.abs(n.getPos().y-t.y)<=25&&(i.y=n.getPos().y);return i}removeSignal(t){let e=this.signals.indexOf(t);e!==-1&&this.signals.splice(e,1)}moveUpSignal(t){let e=this.signals.indexOf(t);if(e>0){let i=this.signals[e];this.signals[e]=this.signals[e-1],this.signals[e-1]=i}}moveDownSignal(t){let e=this.signals.indexOf(t);if(e>=0&&e+1<this.signals.length){let i=this.signals[e];this.signals[e]=this.signals[e+1],this.signals[e+1]=i}}recalculateStateIndices(){let t=this.states.length;for(let e=0;e<t;e++)this.states[e].setIdx(e)}toJSON(){return{id:this.id,signals:this.signals.map(t=>t.toJSON()),states:this.states.map(t=>t.toJSON())}}},w=class{constructor(t,e,i,n,g=""){this.id="";this.type=G.Bit;this.bits=1;this.direction=_.Input;this.desc="";this.id=t,this.type=e,this.bits=i,this.direction=n,this.desc=g}setId(t){this.id=t}setType(t){this.type=t}getType(){return this.type}getId(){return this.id}setBits(t){this.bits=t}getBits(){return this.bits}setDirection(t){this.direction=t}getDirection(){return this.direction}setDesc(t){this.desc=t}getDesc(){return this.desc}toJSON(){return{id:this.id,type:this.type,bits:this.bits,io:this.direction,desc:this.desc}}},G=(n=>(n.Bit="BIT",n.BitN="BIT_N",n.Signed="SIGNED",n.Unsigned="UNSIGNED",n))(G||{}),_=(i=>(i.Input="IN",i.Output="OUT",i.InputOutput="INOUT",i))(_||{}),D=class{constructor(t,e,i="",n=""){this.selected=!1;this.pos={x:0,y:0};this.width=220;this.height=110;this.id="";this.idx=0;this.code="";this.desc="";this.mooreOutput={};this.pos.x=t.x,this.pos.y=t.y,this.id=e,this.code=i,this.desc=n}setId(t){this.id=t}getId(){return this.id}getIdx(){return this.idx}setIdx(t){this.idx=t}setCode(t){this.code=t}getCode(){return this.code}setDesc(t){this.desc=t}getDesc(){return this.desc}getPos(){return this.pos}isSelected(){return this.selected}draw(t){P(t,this.selected,this.pos,this.width,this.height,this.id)}pick(t){return t.x>=this.pos.x-this.width/2&&t.x<=this.pos.x+this.width/2&&t.y>=this.pos.y-this.height/2&&t.y<=this.pos.y+this.height/2}select(t){this.selected=this.pick(t)}toJSON(){return{id:this.id,x:this.pos.x,y:this.pos.y,code:this.code,desc:this.desc,q:this.mooreOutput}}},H=class{constructor(t,e){this.fromAngle=0;this.toAngle=0;this.condition="";this.selected=!1;this.from=t,this.to=e}draw(t){R(t,this.selected,this.from.getPos(),this.to.getPos())}toJSON(){return{u:this.from.getIdx(),v:this.to.getIdx(),"u.angle":this.fromAngle,"v.angle":this.toAngle,cond:this.condition}}};var A=(n=>(n.Select="SELECT",n.InsertMachineState="INSERT_STATE",n.InsertMachineTransitionStart="INSERT_TRANSITION_START",n.InsertMachineTransitionEnd="INSERT_TRANSITION_END",n))(A||{}),v="SELECT",L={x:0,y:0},p=new x,J=null,h=null,y=null;function j(){let s=document.getElementById("help");s.onclick=function(){let f="help.html";window.open(f,"_blank").focus()};let t=document.getElementById("save");t.onclick=function(){console.log(JSON.stringify(p.toJSON(),null,2))};let e=document.getElementById("select");e.checked=!0,e.onclick=function(){v="SELECT"};let i=document.getElementById("insertStartState");i.onclick=function(){console.log("clicked insert start state!")};let n=document.getElementById("insertState");n.onclick=function(){v="INSERT_STATE"};let g=document.getElementById("insertTransition");g.onclick=function(){v="INSERT_TRANSITION_START"};let d=document.getElementById("delete");d.onclick=function(){p.deleteSelection(),T(h,y)};let a=!1,S=document.getElementById("numberConverter"),o=document.getElementById("selection"),r=document.getElementById("signals");r.innerHTML="",r.appendChild(B(p.getSignals()));let l=document.getElementById("addSignal");l.onclick=function(){console.log("add");let f=new w("","BIT",1,"IN","");p.addSignal(f),r.innerHTML="",r.appendChild(B(p.getSignals()))};let m=document.getElementById("numberConverterCollapse");m.onclick=function(){a=!a,m.innerHTML=a?'<i class="fa-solid fa-square-minus"></i>':'<i class="fa-solid fa-square-plus"></i>',S.style.display=a?"block":"none"},h=document.getElementById("canvas"),y=h.getContext("2d"),h.addEventListener("mousemove",f=>{let E=h.getBoundingClientRect(),I=window.devicePixelRatio||1;L.x=Math.round((f.clientX-E.left)*I),L.y=Math.round((f.clientY-E.top)*I),T(h,y)}),h.addEventListener("mouseup",f=>{let E=null;switch(v){case"SELECT":p.select(L);let I=p.getSelectedStates();if(I.length==0)o.innerHTML="(empty)";else{o.innerHTML="";let M=z(I);o.appendChild(M)}break;case"INSERT_STATE":v="SELECT",e.checked=!0;let C=new D(L,"");p.addState(C);break;case"INSERT_TRANSITION_START":v="INSERT_TRANSITION_END",J=p.pickState(L),J==null&&(v="SELECT",e.checked=!0);break;case"INSERT_TRANSITION_END":E=p.pickState(L);let k=new H(J,E);p.addTransition(k),e.checked=!0,v="SELECT";break}T(h,y)}),T(h,y)}function B(s){let t=document.createElement("table");t.classList.add("table","table-bordered","border-dark","shadow"),t.style.tableLayout="fixed";let e=document.createElement("thead");t.appendChild(e);let i=document.createElement("tr");e.appendChild(i),i.classList.add("m-0","p-0");let n=document.createElement("th");i.appendChild(n),n.classList.add("bg-light","text-dark","my-1","py-1"),n.scope="col",n.innerHTML="ID",n=document.createElement("th"),i.appendChild(n),n.classList.add("bg-light","text-dark","my-1","py-1"),n.scope="col",n.innerHTML="TYPE",n=document.createElement("th"),i.appendChild(n),n.classList.add("bg-light","text-dark","my-1","py-1"),n.scope="col",n.innerHTML="BITS",n=document.createElement("th"),i.appendChild(n),n.classList.add("bg-light","text-dark","my-1","py-1"),n.scope="col",n.innerHTML="I/O",n=document.createElement("th"),i.appendChild(n),n.classList.add("bg-light","text-dark","my-1","py-1"),n.scope="col",n.innerHTML="";let g=document.createElement("tbody");t.appendChild(g);for(let d of s){i=document.createElement("tr"),g.appendChild(i),n=document.createElement("th"),i.appendChild(n),n.classList.add("m-0","p-0"),n.scope="row";let a=document.createElement("input");n.appendChild(a),a.type="text",a.classList.add("form-control","border-white"),a.value=d.getId(),a.addEventListener("keyup",c=>{let b=c.target.value;d.setId(b),T(h,y)});let S=["BIT","BIT_N","SIGNED","UNSIGNED"],o=document.createElement("td");i.appendChild(o),o.classList.add("m-0","p-1");let r=document.createElement("div");o.appendChild(r),r.classList.add("dropdown");let l=document.createElement("button");r.appendChild(l),l.classList.add("btn","btn-sm","btn-outline-secondary","text-dark","dropdown-toggle","border-white"),l.type="button",l.setAttribute("data-bs-toggle","dropdown"),l.setAttribute("aria-expanded","false"),l.innerHTML=d.getType();let m=document.createElement("ul");r.appendChild(m),m.classList.add("dropdown-menu");for(let c of S){let b=document.createElement("li");m.appendChild(b);let u=document.createElement("a");b.appendChild(u),u.classList.add("dropdown-item"),u.style.cursor="pointer",u.innerHTML=c;let N=l;u.onclick=function(){switch(c){case"BIT":d.setType("BIT");break;case"BIT_N":d.setType("BIT_N");break;case"SIGNED":d.setType("SIGNED");break;case"UNSIGNED":d.setType("UNSIGNED");break}N.innerHTML=c}}o=document.createElement("td"),i.appendChild(o),o.classList.add("m-0","p-0"),a=document.createElement("input"),o.appendChild(a),a.type="text",a.classList.add("form-control","border-white"),a.value=""+d.getBits(),a.addEventListener("keyup",c=>{let b=c.target.value;d.setBits(parseInt(b)),T(h,y)});let f=["IN","OUT","INOUT"];o=document.createElement("td"),i.appendChild(o),o.classList.add("m-0","p-1"),r=document.createElement("div"),o.appendChild(r),r.classList.add("dropdown"),l=document.createElement("button"),r.appendChild(l),l.classList.add("btn","btn-sm","btn-outline-secondary","text-dark","dropdown-toggle","border-white"),l.type="button",l.setAttribute("data-bs-toggle","dropdown"),l.setAttribute("aria-expanded","false"),l.innerHTML=d.getDirection(),m=document.createElement("ul"),r.appendChild(m),m.classList.add("dropdown-menu");for(let c of f){let b=document.createElement("li");m.appendChild(b);let u=document.createElement("a");b.appendChild(u),u.classList.add("dropdown-item"),u.style.cursor="pointer",u.innerHTML=c;let N=l;u.onclick=function(){switch(c){case"IN":d.setDirection("IN");break;case"OUT":d.setDirection("OUT");break;case"INOUT":d.setDirection("INOUT");break}N.innerHTML=c}}o=document.createElement("td"),i.appendChild(o),o.classList.add("m-0","p-1","text-center");let E=['<i class="fa-solid fa-arrow-up"></i>','<i class="fa-solid fa-arrow-down"></i>','<i class="fa-solid fa-trash-can"></i>'],I=["move up","move down","delete"];for(let c=0;c<E.length;c++){let b=E[c];l=document.createElement("button"),o.appendChild(l),l.classList.add("btn","btn-sm","btn-outline-dark","text-dark"),l.setAttribute("data-bs-toggle","tooltip"),l.setAttribute("data-bs-placement","bottom"),l.title=I[c],l.innerHTML=(c>0?"&nbsp;":"")+b,c==0||c==1?l.onclick=function(){c==0?p.moveUpSignal(d):p.moveDownSignal(d);let u=document.getElementById("signals");u.innerHTML="",u.appendChild(B(p.getSignals()))}:l.onclick=function(){p.removeSignal(d);let u=document.getElementById("signals");u.innerHTML="",u.appendChild(B(p.getSignals()))}}i=document.createElement("tr"),g.appendChild(i),o=document.createElement("td"),i.appendChild(o),o.colSpan=5,o.classList.add("m-0","p-0");let C=document.createElement("div");C.classList.add("btn-group"),o.appendChild(C),C.style.width="calc(100% - 15px)";let k=document.createElement("div");C.appendChild(k),k.classList.add("col","mt-1","ms-1","p-0"),k.style.maxWidth="32px",k.innerHTML='&nbsp;&nbsp;<i class="fa-solid fa-quote-left"></i>';let M=document.createElement("div");C.append(M),M.classList.add("col","m-0","p-0"),a=document.createElement("input"),M.appendChild(a),a.type="text",a.classList.add("form-control","border-white","m-1","p-0"),a.value=d.getDesc(),a.addEventListener("keyup",c=>{let b=c.target.value;d.setDesc(b),T(h,y)})}return t}function z(s){let t=document.createElement("table");t.classList.add("table","table-bordered","border-dark","shadow");let e=document.createElement("thead");t.appendChild(e);let i=document.createElement("tr");e.appendChild(i),i.classList.add("m-0","p-0");let n=document.createElement("th");i.appendChild(n),n.classList.add("bg-light","text-dark","my-1","py-1"),n.scope="col",n.innerHTML="STATE ID";let g=document.createElement("tbody");t.appendChild(g);for(let d of s){i=document.createElement("tr"),g.appendChild(i),n=document.createElement("th"),i.appendChild(n),n.classList.add("m-0","p-0"),n.scope="row";let a=document.createElement("input");n.appendChild(a),a.type="text",a.classList.add("form-control","border-white"),a.value=d.getId(),a.addEventListener("keyup",S=>{let o=S.target.value;d.setId(o),T(h,y)});for(let S=0;S<2;S++){i=document.createElement("tr"),g.appendChild(i);let o=document.createElement("td");i.appendChild(o),o.colSpan=1,o.classList.add("m-0","p-0");let r=document.createElement("div");r.classList.add("btn-group"),o.appendChild(r),r.style.width="calc(100% - 15px)";let l=document.createElement("div");r.appendChild(l),l.classList.add("col","mt-1","ms-1","p-0"),l.style.maxWidth="32px",S==0?l.innerHTML='&nbsp;&nbsp;<i class="fa-solid fa-code"></i>':l.innerHTML='&nbsp;&nbsp;<i class="fa-solid fa-quote-left"></i>';let m=document.createElement("div");r.append(m),m.classList.add("col","m-0","p-0"),a=document.createElement("input"),m.appendChild(a),a.type="text",a.classList.add("form-control","border-white","m-1","p-0"),a.value=S==0?d.getCode():d.getDesc(),a.addEventListener("keyup",f=>{let E=f.target.value;S==0?d.setCode(E):d.setDesc(E),T(h,y)})}}return t}return X(F);})();
